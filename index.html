<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">

  <title>Agenda Semanal</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#4c6ef5">

  <!-- MANIFEST (OBRIGAT√ìRIO PARA APK) -->
  <link rel="manifest" href="manifest.json">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6fa;
      margin: 0;
      padding: 15px;
    }
    h1 {
      text-align: center;
    }
    .section {
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
    }
    input, select, button {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
    }
    .event {
      padding: 6px;
      margin: 5px 0;
      border-radius: 6px;
      color: #fff;
      font-size: 14px;
    }
    .day {
      margin-bottom: 10px;
    }
    .day h3 {
      margin-bottom: 5px;
    }
  </style>
</head>

<body>

<h1>üóìÔ∏è Agenda Semanal</h1>

<div class="section">
  <h2>‚ûï Novo Projeto</h2>
  <input id="projNome" placeholder="Nome do projeto">
  <input type="color" id="projCor">
  <button onclick="criarProjeto()">Criar Projeto</button>
</div>

<div class="section">
  <h2>üìÜ Criar Cronograma</h2>

  <select id="projSelect"></select>

  <label>Dias da semana</label>
  <select id="dias" multiple>
    <option value="1">Segunda</option>
    <option value="2">Ter√ßa</option>
    <option value="3">Quarta</option>
    <option value="4">Quinta</option>
    <option value="5">Sexta</option>
  </select>

  <input type="number" id="quantidade" placeholder="Quantidade de encontros">
  <input type="date" id="inicio">

  <select id="tipo">
    <option>Aula</option>
    <option>Reuni√£o</option>
  </select>

  <button onclick="gerarCronograma()">Gerar</button>
</div>

<div class="section">
  <h2>üìã Semana Atual</h2>
  <div id="agenda"></div>
</div>

<script>
  let projetos = JSON.parse(localStorage.getItem("projetos")) || [];
  let eventos = JSON.parse(localStorage.getItem("eventos")) || [];

  function salvar() {
    localStorage.setItem("projetos", JSON.stringify(projetos));
    localStorage.setItem("eventos", JSON.stringify(eventos));
  }

  function criarProjeto() {
    if (!projNome.value) return;

    projetos.push({
      nome: projNome.value,
      cor: projCor.value || "#4c6ef5"
    });

    projNome.value = "";
    salvar();
    atualizarSelect();
  }

  function atualizarSelect() {
    projSelect.innerHTML = "";
    projetos.forEach((p, i) => {
      projSelect.innerHTML += `<option value="${i}">${p.nome}</option>`;
    });
  }

  function gerarCronograma() {
    if (!inicio.value || !quantidade.value) return;

    let proj = projetos[projSelect.value];
    let diasSel = Array.from(dias.selectedOptions).map(o => parseInt(o.value));
    let qtd = parseInt(quantidade.value);
    let data = new Date(inicio.value);
    let count = 0;

    while (count < qtd) {
      if (diasSel.includes(data.getDay())) {
        eventos.push({
          data: data.toISOString().slice(0, 10),
          nome: proj.nome,
          tipo: tipo.value,
          cor: proj.cor
        });
        count++;
      }
      data.setDate(data.getDate() + 1);
    }

    salvar();
    mostrarSemana();
  }

  function mostrarSemana() {
    agenda.innerHTML = "";

    let hoje = new Date();
    let inicioSemana = new Date(hoje);
    inicioSemana.setDate(hoje.getDate() - hoje.getDay() + 1);

    for (let i = 0; i < 5; i++) {
      let d = new Date(inicioSemana);
      d.setDate(inicioSemana.getDate() + i);
      let dataStr = d.toISOString().slice(0, 10);

      agenda.innerHTML += `<div class="day"><h3>${d.toLocaleDateString()}</h3></div>`;

      eventos
        .filter(e => e.data === dataStr)
        .forEach(e => {
          agenda.innerHTML += `
            <div class="event" style="background:${e.cor}">
              ${e.nome} ‚Äì ${e.tipo}
            </div>
          `;
        });
    }
  }

  atualizarSelect();
  mostrarSemana();
</script>

</body>
</html>
